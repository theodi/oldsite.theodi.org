function processCourses(e,t){occurs=[];for(t.sort(function(e,t){return new Date(e.details.date)-new Date(t.details.date)}),p=0;p<t.length;p++)if(instance=t[p],coursename=instance.details.course,!done[coursename])for(q=0;q<e.length;q++)course=e[q],course.slug==coursename&&(done[coursename]=!0,processCourse(course,t));for(r=0;r<e.length;r++)course=e[r],coursename=course.slug,done[coursename]||(processCourse(course,t),done[coursename]=!0)}function processCourse(e,t){for(title=e.title,link=e.web_url,subtitle=e.details.excerpt,subtitle.length>140&&(subtitle=subtitle.substring(0,140),subtitle=subtitle.substring(0,subtitle.lastIndexOf(" ")),subtitle=subtitle+"...<a style='color: #333; text-decoration: underline; font-size: 0.9em;' href='"+link+"'>read more</a>"),duration=e.details.length,key=e.slug,occurs=getCourseInstances(t,key),heading="<h2 style='font-size: 1.5em;'><a href='"+link+"'>"+title+"</a></h2><p class='courseSub'>"+subtitle+"</p>",icons='<ul class="course_properties">',icons+='<li><img src="//static.theodi.org/assets/training/'+duration.replace(/ /g,"_")+'.png" title="'+duration+'" alt="'+duration+'"></img></li>',icons+='<li><img src="//static.theodi.org/assets/training/f2f.png" title="Face to face training" alt="Face to face training"></img></li>',icons+="</ul>",running='<div class="instances"><ul>',k=0;k<occurs.length;k++)ocr=occurs[k],k<2&&(running+='<li><span id="courseLoc">'+ocr.displayDate+" <small>("+ocr.location+')</small></span><a href="'+ocr.url+"?_eboga="+gaClientId+'" class="courseButton bookButton btn btn-primary" style="border: 1px solid #333;" onclick="onBookButton(\''+title+"','"+ocr.shortDate+"')\">Book</a></li>");running+="</ul></div>",occurs.length<1&&(running='<div class="instances">&nbsp;<br/><div class="noInstances"><a class="courseButton btn btn-primary" href="mailto:training@theodi.org?subject=Interest in '+title+' course" style="border: 1px solid #333;">Register interest</div></div>'),block='<li id="course" class="home-module shown"><div class="module2 module module-light module-colour-'+colors[colourInc]+' module-highlight-1">'+heading+icons+running+"</div></li>",$("#courses").append(block),colourInc+=1,colourInc>2&&(colourInc=0)}function getCourseInstances(e,t){occurs=[];var n=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];for(e.sort(function(e,t){return new Date(e.details.date)-new Date(t.details.date)}),j=0;j<e.length;j++)instance=e[j],instance.details.course==t&&(ins=[],ins.date=instance.details.date,ins.price=instance.details.price,ins.location=instance.details.location,ticketsAvailable="true",instance.details.ticketsAvailable&&(ticketsAvailable=instance.details.ticketsAvailable),instance.details.location&&(instance.details.location.indexOf("London")>0||instance.details.location.indexOf("65 Clifton Street")>0?ins.location="London":(parts=instance.details.location.split(","),ins.location=parts[parts.length-2].trim())),ins.url=instance.details.url,now=new Date,run=new Date(ins.date),day=run.getDate(),month=run.getMonth(),suffix="th",1!=day&&21!=day&&31!=day||(suffix="st"),2!=day&&22!=day||(suffix="nd"),3!=day&&23!=day||(suffix="rd"),ins.displayDate=day+suffix+" "+n[month],ins.shortDate=(day<10?"0":"")+day+(month<9?"0":"")+(month+1)+run.getFullYear(),run>now&&occurs.push(ins));return occurs}function renderInstances(e){for(console.log(e),i=0;i<e.length;i++)ocr=e[i],html="<tr><td>"+ocr.displayDate+" <small>("+ocr.location+")</small></td><td>"+ocr.price+'</td><td><a href="'+ocr.url+'" class="courseButton bookButton btn btn-primary" style="border: 1px solid #333;">Book</a></td></tr>',$("#instances").append(html)}function getInstances(e){e=window.location.pathname,e=e.substring(e.lastIndexOf("/")+1,e.length),console.log(e);var t;$.getJSON("https://odi-courses-data.herokuapp.com/query.php?course="+e,function(n){t=getCourseInstances(n.results,e),renderInstances(t),$("#instances").show()}).error(function(){$("#instances").hide()})}function onBookButton(e,t){ga("send","event","Course Enquiry","Click",e,t)}var done=[];colourInc=0;var colors=[2,10,7],gaClientId="";ga(function(e){gaClientId=e.get("clientId")}),$.ajaxSetup({cache:!1});