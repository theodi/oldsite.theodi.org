<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<title>Adapting Git for simple data | News | Open Data Institute</title>
<link href="../assets/application-693091b423df059e90189392fffb0ae0.css" media="all" rel="stylesheet" type="text/css">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="../assets/favicon-e0340b5bc5738e53c1b06680529c0963.ico" rel="shortcut icon" type="image/vnd.microsoft.icon">

<!--[if lt IE 9]>
      <script src="../assets/html5shiv-5d1c7196accd7174ed22f320c693b063.js" type="text/javascript"></script>
    <![endif]-->

<!--[if (IE 7)|(IE 8)]>
      <script src="../assets/respond.min-5eec43180e3f6d282f038de07483dc4b.js" type="text/javascript"></script>
    <![endif]-->

<script src="../assets/modernizr.custom-1ecf37d7f9fbb3066a877e31ce79e79e.js" type="text/javascript"></script>

<!--[if lte IE 9]><link href="../assets/ie9-875f0d42a52ff5536404da8fda8d423b.css" media="screen" rel="stylesheet" type="text/css" /><![endif]-->
<!--[if lte IE 8]><link href="../assets/ie8-4a6b9f309032dacb3913ccc2d55bda8b.css" media="screen" rel="stylesheet" type="text/css" /><![endif]-->
<!--[if lte IE 7]><link href="../assets/ie7-d4066942f039a08eed8b62b80cde16cb.css" media="screen" rel="stylesheet" type="text/css" /><![endif]-->
<!--[if lt IE 7]><link href="../assets/ie6-cab152e9612eeec9bd0af579a2231dd5.css" media="screen" rel="stylesheet" type="text/css" /><![endif]-->

<meta property="fb:pages" content="1755416561338416">
<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
<link href="../blog/adapting-git-simple-data.json" rel="alternate" title="json" type="application/json">
<meta content="The Open Data Institute (ODI) equip, connect and inspire people around the world to innovate with data. Co-founded by Sir Tim Berners-Lee and Sir Nigel Shadbolt, the ODI provides events, training, membership and consultancy around open data." name="description">
<meta content="summary_large_image" name="twitter:card">
<meta content="@ODIHQ" name="twitter:site">
<meta content="Adapting Git for simple data | News | Open Data Institute" property="og:title">
<meta content="article" property="og:type">
<meta content="../blog/adapting-git-simple-data" property="og:url">
<meta content="../uploads/assets/legacy/diff%2Dcolour.png" property="og:image">
<meta content="Open Data Institute" property="og:site_name">
<meta content="The Open Data Institute (ODI) equip, connect and inspire people around the world to innovate with data. Co-founded by Sir Tim Berners-Lee and Sir Nigel Shadbolt, the ODI provides events, training, membership and consultancy around open data." property="og:description">
<meta name="govuk:rendering-application" content="Www">
<script type="text/javascript">


  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-34573394-1', {});
















   ga('send', 'pageview');


</script></head>
<body>
<header class="site-header">
<div class="navbar navbar-inverse navbar-static-top">
<div class="container">
<div class="navbar-header">

<button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
<span class="icon-bar"></span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
</button>
<a class="navbar-brand" href="../"><img alt="The ODI" id="odi-logo" src="../assets/logo-header-dc4ead7a18ea4133873c79502c174638.png"></a>
</div>
<div class="modal fade" id="getLogo" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
<div class="modal-dialog">
<div class="modal-content">
<div class="modal-header">
<h4 class="modal-title" id="myModalLabel">Welcome to the ODI
<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&#215;</button>
</h4>
</div>
<div class="modal-body">
<p>Knowledge for everyone</p>
<p>The ODI helps to unlock the value of open data.</p>
<p>If you want to use our logo, different sizes and types are here: <a href="../brand">../brand</a></p>
<p><a rel="external" href="../uploads/assets/legacy/ODI%2Dlogo%2Dsml.png"><img src="../uploads/assets/legacy/ODI%2Dlogo%2Dsml.png" alt=""></a></p>
<p><a rel="external" href="../uploads/assets/legacy/ODI%2Dlogo%2Dmed.png"><img src="../uploads/assets/legacy/ODI%2Dlogo%2Dmed.png" alt=""></a></p>
<p><a rel="external" href="../uploads/assets/legacy/ODI%2Dlogo%2Dmed.png"><img src="../uploads/assets/legacy/ODI%2Dlogo%2Dlg.png" alt=""></a></p>
<p><a rel="external" href="../uploads/assets/legacy/ODI%2Dlogo%2Dmed.png"><img src="../uploads/assets/legacy/ODI%2Dlogo%2Dxlg.png" alt=""></a></p>
</div>
</div>
</div>
</div>
<ul class="nav navbar-nav navbar-right">
<li><a href="../contact">Contact us</a></li>
<li><a href="../newsletters">Newsletters</a></li>

</ul>

<form class="navbar-form navbar-right" method="get" action="//duckduckgo.com/">
<div class="form-group">
<div class="input-group">
<input value="oldsite.theodi.org" name="sites" type="hidden">
<input class="form-control" placeholder="Search ODI" name="q" type="text">
<input value="Go" class="btn" type="submit">
</div>
</div>
</form>
</div>
</div>
<div class="collapse navbar-collapse">
<div class="navbar navbar-static-top">
<div class="container">
<ul class="nav navbar-nav main-nav">
<li class="dropdown">
<a href="../news">
News &amp; blog
</a>
</li>
<li class="dropdown">
<a href="../get-involved">
Get involved
</a>
</li>
<li class="dropdown">
<a href="../our-network">
Our global network
</a>
</li>
<li class="dropdown">
<a href="../events">
Events
</a>
</li>
<li class="dropdown">
<a href="../our-focus">
Our focus
</a>
</li>
<li class="dropdown">
<a href="../publications">
Publications
</a>
</li>
<li class="dropdown last">
<a href="../about">
About the ODI
</a>
</li>
</ul>
</div>
</div>
</div>
<div class="navbar navbar-inverse navbar-static-top mobile-only">
<div class="container">
<ul class="nav navbar-nav navbar-right">
<li><a href="../contact">Contact us</a></li>
<li><a href="../newsletters">Newsletters</a></li>

</ul>

</div>
</div>
</header>
<div id="oldsite-banner" style="background-color: #ff6700; color: white; text-align: center; padding: 1rem; margin-bottom: 1rem; font-weight: 0.5;">
	<h2>WEBSITE RETIRED</h2>
	<p>This website has been retired and is available for reference and historical purposes only.</p>
	<p><a id="newSiteLink" href="#newSiteLink" style="color: white; text-decoration: underline;">Click here to navigate to the new website.</a></p>
	<p><i>Note: Some pages have not been migrated and you may end up back on this site as a result.</i></p>
	<script>
		(function() {
		var newURL = window.location.protocol + "//theodi.org" + "/" + window.location.pathname + window.location.search;
		document.getElementById("newSiteLink").setAttribute("href",newURL);
		})();
	</script>
</div> 
<div id="wrapper">
<header class="page-title">
<div class="container header-wrap">
<h1> <a href="../news">News</a>
</h1>
</div>
</header>
<div class="container">
<div class="row">
<div class="article-main">
<article class="article-body">
<h2>Adapting Git for simple data</h2>
<div class="article-meta">
<span class="date">2013-08-19</span> by
<a href="../team/james-smith" class="author">James Smith <img alt="James Smith" height="50" src="http://contentapi.theodi.org/james-smith/image?version=square" width="50"></a>
</div>
<p>A while ago I wrote about using <a href="../blog/git-data-publishing">Git for data publishing</a>, and talked about how the tools and particularly the workflow used by many open source projects could revolutionise how we create, publish, and collaborate on open data. I'm not the only one thinking this, of course; amongst many others, Rufus Pollock from the OKFN has <a href="http://blog.okfn.org/2013/07/02/git-and-github-for-data/">written on the same subject</a> <a href="http://blog.okfn.org/2010/07/12/we-need-distributed-revisionversion-control-for-data/">many times</a>, and they've been hosting <a href="https://github.com/datasets">datasets on Github</a>for a good while now, as have other organisations.</p>
<p>However, we've not cracked the tooling problem. Data is complex stuff; it may be that we need new tools to handle it, like <a href="http://rawbase.github.io/">R&amp;Wbase</a>, or Max Ogden's new <a href="https://github.com/maxogden/dat">dat</a> project. However, I tend to side with those who reckon we can do a lot more with the tools we already have (not that there are <em>sides</em> or anything, we're all friends). As <a href="http://ben.balter.com/2013/07/01/technologys-the-easy-part/">Ben Balter wrote</a>:</p>
<blockquote>
<p>We should be co-opting proven tools already in the hands of public servants and making it so ridiculously straightforward for government agencies to distribute information and build collaborative communities around shared problems that it would be criminal for them not to.</p>
</blockquote>
<p>With this in mind, I've continued hacking away at the tools we already have, trying to make them work for data. Not <em>all</em> data, but certainly for small, simple datasets, particularly data in simple CSV format. At this point, we're going to dive into a few Git internals, so apologies if it gets a little technical from here on in.</p>
<h2 id="makinggitworkwithcsvs">Making Git work with CSVs</h2>
<p>The main problem with using git for things like CSV formats comes because it stores changes line-by-line. If you compare two files, you can see the lines that have changed. That's great if your information is line-oriented, but it falls over for CSV. Row operations are OK, but column operations hit every single line, making git's built-in comparisons useless.</p>
<p>What can we do about this? As a user, I don't care how efficiently the change is stored internally, as long as I can understand what's happening, so this really just comes down to presentation.</p>
<p>Let's take a look at a sample bit of data, and let's look at the one bit of software everyone using git has - the command-line interface. Here's a diff of a change I made:</p>
<p><code>git diff data.csv</code></p>
<p><img src="../uploads/assets/legacy/diff%2Dcolour.png" alt="git diff"></p>
<p>So far, so impenetrable. I think I can see that there's a new column in there, but if anything else changed, I'm certainly not going to spot it in amongst all that.</p>
<p>However, git allows us to customise how we show diffs for different formats. Using <a href="http://git-scm.com/book/ch7-2.html">git attributes</a>, we can tell git how we want it to handle CSV files, including customising various things about how diffs are performed.</p>
<p>We also need to use git's--word-diff option, which is used to show differences within lines in text by splitting along word boundaries. If we tell git that we want to use the word-diff, we can then customise how the line is split up for CSV files in particular.</p>
<p>Let's try something stupid first, and say that <em>every character</em> should be treated as a separate word when doing word-diffs. We add a csv file type to a shared git attributes file, and add a diff filter for CSV that specifies a simple word regex that will match any character:</p>
<pre><code># ~/.config/git/attributes
*.csv    diff=csv

# ~/.gitconfig
[diff "csv"]
    wordRegex = .
</code></pre>
<p><code>git diff --word-diff data.csv</code></p>
<p><img src="../uploads/assets/legacy/wordRegexDot.png" alt="wordRegex=."></p>
<p>This is already a <em>lot</em> better. We can see what's going on at least. Not only have I added a column, but I've added a row for Mercury, and fixed some formatting near the end. I really should learn to split up my commits better.</p>
<p>However good this looks, it's not right. The diff picks up the wrong bits as part of a change sometimes, like the 'a' in the first line, or the quotes at the start of the Mercury line. Let's make it a bit more CSV-specific.</p>
<pre><code># ~/.gitconfig
[diff "csv"]
    wordRegex = [^,\n]+[,\n]|[,]
</code></pre>
<p>The regular expression here took a bit of working out, so I won't explain character by character, but suffice it to say that it tells git that 'words' are things that end in commas or newlines. That turns out to do exactly what we want:</p>
<p><code>git diff --word-diff data.csv</code></p>
<p><img src="../uploads/assets/legacy/csv%2Ddiff.png" alt="CSV diff"></p>
<p>Not only do the diffs now line up to fields, we get entire field changes being shown, as in the last two lines.</p>
<p>This is great, and means that for people who use the command line, CSV diffs are now a possibility. Unfortunately, this has to be configured per-user; there is no way to do it for a repository. With that in mind, I've tried to make the configuration as easy as possible, and created a script called <a href="https://github.com/theodi/csv-my-git">csv-my-git</a> which sets this up for you on your local machine. You can just enter the following command in a terminal, and it will sort it all out for you:</p>
<pre><code>curl -L http://theodi.github.io/csv-my-git/install.sh | bash
</code></pre>
<p>It sets up the format, and also adds a <code>git diffcsv</code> alias for you to simplify the command line a bit (as suggested by <a href="https://twitter.com/samuelleach">Sam Leach</a>).</p>
<p>There are some obvious problems here - firstly, it assumes a very simple CSV format. If you use tabs to separate your fields, then this will currently not work. However, it's open source, so improvements and contributions are welcome! Secondly, you have to include the --word-diff option (or use diffcsv) every time; if anyone knows how to make word-diff the <em>default</em> for a particular file type, I will buy you a decent number of drinks.</p>
<h2 id="customisingwebuis">Customising Web UIs</h2>
<p>The command line is all very well; it lets us prove that this is <em>possible</em>, but even I, as a seasoned developer, rarely use git on the command line. Let's make something a bit more usable.</p>
<p>As the problem is one of display and tooling, we don't need to fundamentally change git. We just need to change the tools; and the big tool that we want this to work with is <a href="http://github.com">GitHub</a>. If we could get proper CSV support into GitHub's commit views and pull requests, well, that would be a thing of beauty.</p>
<p>Unfortunately for us, GitHub isn't open source, so we can't just change it. Fortunately, however, there is an open source github-alike called <a href="http://gitlab.org/">Gitlab</a>, which we <em>can</em> change. Yay open source!</p>
<p>Gitlab's default view for CSV is to show it as a text diff, very similar to the first command-line one above. Not useful. However, it's incredibly easy to configure. We add a method to detect if a file is a CSV, and then we can write a CSV-specific view. Here's a view showing the contents of a CSV file in a table, rather than just as text, in Gitlab:</p>
<p><img src="../uploads/assets/legacy/csv_table.png" alt="Gitlab CSV view"></p>
<p>Nice and simple, but proving we can do it.</p>
<p>Next thing is to add diff support. Now, showing diffs in tabular format, that's a non-trivial UI challenge, I thought to myself. Then up popped <a href="http://okfnlabs.org/blog/2013/08/08/diffing-and-patching-data.html">an <em>incredibly</em> well-timed post</a> on the OKFN Labs blog by Paul Fitzpatrick about his <a href="http://paulfitz.github.io/coopyhx/">coopyhx</a> project, which does <em>exactly</em> this. It even has a bit of Javascript which, given two tables, shows the diff in a really useful way.</p>
<p>So, back to Gitlab; all we need is the old file, the new file, a bit of coopyhx javascript, and suddenly we have a diff view of CSV files right there in your commit logs and pull requests:</p>
<p><img src="../uploads/assets/legacy/csv_gitlab_diff.png" alt="CSV diff in Gitlab"></p>
<p>This is, quite simply, spectacular. If we could get GitHub to add something like this, I think around 95% of our data sharing and collboration work would get easier. Failing that, we just need someone to host a Gitlab instance with CSV support!</p>
<p>The Gitlab work is still very much a work in progress, but you can get the code from the <a href="https://github.com/theodi/gitlabhq/tree/csv-view">csv-view branch of our gitlab fork</a>, and also <a href="https://github.com/gitlabhq/gitlabhq/pull/4810">weigh in on the Gitlab pull request</a>. As with the git configuration above, it needs to be more robust and handle other formats, but I think this is a really good step towards solving some of problems we have with git for data, and proving that we really <em>can</em> do a hell of a lot with the tools we already have.</p>
<p><strong>Update:</strong></p>
<p>A few days after this was published, GitHub released an update that shows <a href="https://github.com/blog/1601-see-your-csvs">CSVs in their web interface</a>. It includes linking of lines, search, filtering, and is really really nice. I think that while this is a big step forward, the really useful stuff comes when we can properly use the fork / pull request model with data, and diffs are essential for that. Unfortunately, CSV diffs are still shown in the traditional line-at-a-time way. You never know though, maybe it won't be long.</p>
</article>
<div class="tags">
<h3>Tagged as:</h3>
</div>
<h3>Comments</h3>
<div id="juvia_comments"></div>
</div>
<aside class="article-sidebar listing">
<div class="tags">
<h3>Tagged as:</h3>
</div>
<h3>Latest blog post</h3>
<iframe seamless scrolling="no" src="../blog/module"></iframe>
<h3>Latest news</h3>
<iframe seamless scrolling="no" src="../news/module"></iframe>
</aside>
</div>
</div>
</div>
<footer class="site-footer">
<div class="container">
<div class="row">
<div class="col-md-8 footer-content">
<h1 class="footer-logo"><a href="http://oldsite.theodi.org">Open Data Institute</a></h1>
<p><a href="../contact">Open Data Institute, 65 Clifton Street, London EC2A 4JE</a></p>
<p><a href="../cdn-cgi/l/email-protection#0c65626a634c78646963686522637e6b"><span class="__cf_email__" data-cfemail="3a53545c557a4e525f555e531455485d">[email&#160;protected]</span></a> Company <a href="http://opencorporates.com/companies/gb/08030289">08030289</a>
<span>VAT</span><span>143 7796 80</span>
</p>
<p class="license">
<a href="http://creativecommons.org/licenses/by-sa/2.0/uk/deed.en_GB" rel="license">
<img alt="Creative Commons Licence" height="15" src="../assets/cc-a23fe95f04508432c8d97c00b0a36254.png" width="80">
</a>
</p>
</div>
<div class="col-md-4 footer-nav">
<nav><ul class="pull-right list-inline">
<li><a href="http://www.twitter.com/ODIHQ" class=" ">
<img alt="Follow us on Twitter" src="../assets/twitter-a658ecc9fe2aab3308a5fb36adfb9a64.png" title="Follow us on Twitter"></a></li>
<li><a href="https://soundcloud.com/theodi" class=" ">
<img alt="Listen on Soundcloud" src="../assets/soundcloud-3932b3db23c6fb6c45bce20c8016462c.png" title="Listen on Soundcloud"></a></li>
<li><a href="http://www.scribd.com/OpenDataInstitute" class=" ">
<img alt="Read on Scribd" src="../assets/scribd-8afadecb87771fd6f6814e6ea81fb23d.png" title="Read on Scribd"></a></li>
<li><a href="https://github.com/orgs/theodi" class=" ">
<img alt="Follow us on Github" src="../assets/github-914931d2a14f54f3c64caec5c6e68017.png" title="Follow us on Github"></a></li>
<li><a href="http://vimeo.com/theodiuk" class=" ">
<img alt="Watch on Vimeo" src="../assets/vimeo-a865234771edd239032629b694ddaa32.png" title="Watch on Vimeo"></a></li>
<li><a href="http://www.youtube.com/user/OpenDataInstituteUK" class=" ">
<img alt="Watch on Youtube" src="../assets/youtube-cccfa6f837a0acfe0d2fd9492b0d45b3.png" title="Watch on Youtube"></a></li>
<li><a href="http://www.flickr.com/photos/ukodi/" class=" ">
<img alt="Follow us on Flickr" src="../assets/flickr-c81d78a530d046663cfff44293f6f775.png" title="Follow us on Flickr"></a></li>
</ul></nav>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<nav><ul class="pull-right list-inline">
<li class=" "><a href="../terms-of-use" class=" ">Terms of use</a></li>
<li class=" "><a href="../privacy-policy" class=" ">Privacy policy</a></li>
<li class=" "><a href="../cookie-policy" class=" ">Cookie policy</a></li>
</ul></nav>
</div>
</div>
</div>
</footer>
<script data-cfasync="false" src="../cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>

  var _pt = ["E6AF1363-3E19-409A-983C-91FFE62C2CBB"];
  (function(d,t){
    var a=d.createElement(t),s=d.getElementsByTagName(t)[0];a.src=location.protocol+'//a1webstrategy.com/track.js';s.parentNode.insertBefore(a,s);
  }(document,'script'));

  </script>
<script type="text/javascript">
      (function (n) {
          var u = window.location.href;
          var p = u.split("/")[0];
          var t = n.createElement("script"), i;
          t.type = "text/javascript";
          t.async = !0;
          t.src = p + "//dashboard.whoisvisiting.com/who.js";
          i = n.getElementsByTagName("script")[0];
          i.parentNode.insertBefore(t, i)
      })(document);

          var whoparam = whoparam || [];
          whoparam.push(["AcNo", "8d5d04b9adc94a34bc385c6f3370594e"]);
          whoparam.push(["SendHit", ""]
      );
  </script>
<script src="../assets/application-4829863ea093de33ae55c9a127d6af6b.js" type="text/javascript"></script>

<!--[if gt IE 7]><!-->
<script src="../assets/bootstrap/bootstrap-collapse-c4cb45620c1346753e2385c125ed4bdd.js" type="text/javascript"></script>
<!--<![endif]-->


<!--[if gt IE 7]><!-->
<script src="../assets/masonry-c617ee0c7d6c602b548ab5e69d50f4fa.js" type="text/javascript"></script>
<script src="../assets/infinitescroll-243a7a50c0c843f1deb394ea98f4d0a6.js" type="text/javascript"></script>
<script src="../assets/background-check-677e6100d9ce594cd30a88f57fc49b48.js" type="text/javascript"></script>
<!--<![endif]-->
<script type="text/javascript" class="juvia">
          (function() {
              var options = {
                  container    : '#juvia_comments',
                  site_key     : 't2u3ylvi0t1s94ggzxpltbcf1jyapxp',
                  topic_key    : 'adapting-git-simple-data' || location.href,
                  topic_url    : location.href,
                  topic_title  : document.title || location.href,
                  include_base : !window.Juvia,
                  include_css  : false,
                  comment_order: 'earliest-first'
              };

              function makeQueryString(options) {
                  var key, params = [];
                  for (key in options) {
                      params.push(
                          encodeURIComponent(key) +
                          '=' +
                          encodeURIComponent(options[key]));
                  }
                  return params.join('&');
              }

              function makeApiUrl(options) {
                  // Makes sure that each call generates a unique URL, otherwise
                  // the browser may not actually perform the request.
                  if (!('_juviaRequestCounter' in window)) {
                      window._juviaRequestCounter = 0;
                  }

                  var result =
                      'https://juvia.theodi.org/api/show_topic.js' +
                      '?_c=' + window._juviaRequestCounter +
                      '&' + makeQueryString(options);
                  window._juviaRequestCounter++;
                  return result;
              }

              var s       = document.createElement('script');
              s.async     = true;
              s.type      = 'text/javascript';
              s.className = 'juvia';
              s.src       = makeApiUrl(options);
              (document.getElementsByTagName('head')[0] ||
               document.getElementsByTagName('body')[0]).appendChild(s);
            })();
          </script>
</body>
</html>
